var WebSheet=function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="/",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}n(2);var i=n(6),a=r(i),s=n(11),o=r(s),l=n(16),u=r(l);o["default"].parseExpression=a["default"],o["default"].WebSheetContext=u["default"],e.exports=o["default"]},function(e,t,n){var r=n(3);"string"==typeof r&&(r=[[e.id,r,""]]);n(5)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){t=e.exports=n(4)(),t.push([e.id,'.websheet,.websheet *,.websheet :after,.websheet :before{box-sizing:content-box}.websheet.websheet-grabbing{cursor:-webkit-grabbing;cursor:grabbing}.websheet-row{display:block;padding-right:1px}.websheet-row-sticky{position:-webkit-sticky;position:sticky;top:0;z-index:2}.websheet-cell-wrapper{border:1px solid #000;display:inline-block;margin-bottom:-1px;margin-right:-1px;position:relative;z-index:1}.websheet-cell-wrapper.websheet-has-focus{border:0;cursor:-webkit-grab;cursor:grab;margin:-6px -6px -6px -5px!important;padding:6px;z-index:2}.websheet-cell-wrapper:last-child{margin-right:0}.websheet-row:last-child .websheet-cell-wrapper{margin-bottom:0}.websheet-cell{-moz-appearance:none;-webkit-appearance:none;background:transparent;border:0;border-radius:1px;box-shadow:0 0 0 0 rgba(51,153,255,.85);display:block;font-size:13px;height:2em;transition:box-shadow .15s,z-index .15s;width:100%}.websheet-cell:focus{border:0 solid #39f;box-shadow:0 0 0 7px rgba(51,153,255,.85);outline:none}.websheet-cell-wrapper:after{background:#39f;border:2px solid #fff;border-radius:4px;bottom:5px;content:"";display:block;height:5px;opacity:0;position:absolute;right:5px;transition:bottom .25s,right .25s,opacity .1s;width:5px}.websheet-cell-wrapper.websheet-has-focus:after{bottom:-4px;cursor:crosshair;opacity:1;right:-4px}.websheet-cell-hover input{background:#39f;color:#fff}',""])},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push("@media "+n[2]+"{"+n[1]+"}"):e.push(n[1])}return e.join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},i=0;i<this.length;i++){var a=this[i][0];"number"==typeof a&&(r[a]=!0)}for(i=0;i<t.length;i++){var s=t[i];"number"==typeof s[0]&&r[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),e.push(s))}},e}},function(e,t,n){function r(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=d[r.id];if(i){i.refs++;for(var a=0;a<i.parts.length;a++)i.parts[a](r.parts[a]);for(;a<r.parts.length;a++)i.parts.push(u(r.parts[a],t))}else{for(var s=[],a=0;a<r.parts.length;a++)s.push(u(r.parts[a],t));d[r.id]={id:r.id,refs:1,parts:s}}}}function i(e){for(var t=[],n={},r=0;r<e.length;r++){var i=e[r],a=i[0],s=i[1],o=i[2],l=i[3],u={css:s,media:o,sourceMap:l};n[a]?n[a].parts.push(u):t.push(n[a]={id:a,parts:[u]})}return t}function a(e,t){var n=v(),r=w[w.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),w.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function s(e){e.parentNode.removeChild(e);var t=w.indexOf(e);t>=0&&w.splice(t,1)}function o(e){var t=document.createElement("style");return t.type="text/css",a(e,t),t}function l(e){var t=document.createElement("link");return t.rel="stylesheet",a(e,t),t}function u(e,t){var n,r,i;if(t.singleton){var a=b++;n=m||(m=o(t)),r=c.bind(null,n,a,!1),i=c.bind(null,n,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=l(t),r=p.bind(null,n),i=function(){s(n),n.href&&URL.revokeObjectURL(n.href)}):(n=o(t),r=h.bind(null,n),i=function(){s(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}function c(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=y(t,i);else{var a=document.createTextNode(i),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(a,s[t]):e.appendChild(a)}}function h(e,t){var n=t.css,r=t.media;t.sourceMap;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function p(e,t){var n=t.css,r=(t.media,t.sourceMap);r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var i=new Blob([n],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(i),a&&URL.revokeObjectURL(a)}var d={},f=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},g=f(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),v=f(function(){return document.head||document.getElementsByTagName("head")[0]}),m=null,b=0,w=[];e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=g()),"undefined"==typeof t.insertAt&&(t.insertAt="bottom");var n=i(e);return r(n,t),function(e){for(var a=[],s=0;s<n.length;s++){var o=n[s],l=d[o.id];l.refs--,a.push(l)}if(e){var u=i(e);r(u,t)}for(var s=0;s<a.length;s++){var l=a[s];if(0===l.refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete d[l.id]}}}};var y=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e){function t(){var n=e.substr(j);if(!n)return"EOF";var r,i;if(r=C.exec(n))return j+=r[0].length,t();if(r=u.exec(n))i=new s["default"]("boolean",r[0].toLowerCase());else if(r=c.exec(n))i=new s["default"]("string",JSON.parse(r[0]));else if(r=p.exec(n))i=new s["default"]("number",r[0]);else if(r=v.exec(n))i=new s["default"]("funcopen",r[1]);else if(r=m.exec(n))i=new s["default"]("sheetref",r[1]);else if(r=h.exec(n))i=new s["default"]("ident",r[0].toUpperCase());else if(r=b.exec(n))i=new s["default"]("rparen",")");else if(r=w.exec(n))i=new s["default"]("lparen","(");else if(r=d.exec(n))i=new s["default"]("binop_times",r[0]);else if(r=f.exec(n))i=new s["default"]("binop_add",r[0]);else if(r=g.exec(n))i=new s["default"]("binop_comp",r[0]);else if(r=y.exec(n))i=new s["default"]("comma",",");else if(r=x.exec(n))i=new s["default"]("percent","%");else{if(!(r=_.exec(n)))throw new SyntaxError("Unknown token: "+n);i=new s["default"]("colon",":")}return r&&(j+=r[0].length),i}function n(){return L=L||t()}function r(){var e=L||t();return L=null,e}function i(e){var t=n();return t&&t.type===e?r():null}function a(e){var t=r();if(t.type!==e)throw new SyntaxError("Expected "+e+", got "+t.type);return t}function o(){var e,t=n();if(t&&"-"===t.value?(t=!0,r()):t=!1,e=i("boolean"))return new l["default"]("boolean",{value:"true"===e.value});if(e=i("number")){var a=e.value,s=parseFloat(e.value);return i("percent")&&(a+="%",s/=100),new l["default"]("number",{value:s,raw:a})}if(e=i("string"))return new l["default"]("string",{value:e.value});if(e=i("ident")){var o=h.exec(e.value);return new l["default"]("identifier",{value:o[2]+o[4],pinRow:"$"===o[3],pinCol:"$"===o[1],raw:e.value})}throw new SyntaxError("Unrecognized primitive value")}function S(){var e=o();if(!e||"identifier"!==e.type)return e;if(i("colon")){var t=a("ident");e=new l["default"]("range",{start:e,end:new l["default"]("identifier",{value:t.value})})}return e}function N(){var e=i("funcopen");if(!e)return S();for(var t=[];n()&&!i("rparen");)t.length&&a("comma"),t.push(U());return new l["default"]("function",{name:e.value,args:t})}function D(){var e=i("sheetref");return e?new l["default"]("sheetlookup",{sheet:e.value,content:S()}):N()}function E(){if(!i("lparen"))return D();var e=U();return a("rparen"),e}function O(){var e=E(),t=i("binop_times");return t?new l["default"]("*"===t.value?"binop_mult":"/"===t.value?"binop_div":"binop_expon",{left:e,operator:t.value,right:O()}):e}function P(){var e=O(),t=i("binop_add");return t?new l["default"]("+"===t.value?"binop_add":"&"===t.value?"binop_concat":"binop_sub",{left:e,operator:t.value,right:P()}):e}function R(){var e=P(),t=i("binop_comp");if(!t)return e;var n;switch(t.value){case"<":n="binop_comp_lt";break;case"<=":n="binop_comp_lte";break;case">":n="binop_comp_gt";break;case">=":n="binop_comp_gte";break;case"=":n="binop_comp_eq";break;case"<>":n="binop_comp_neq"}return new l["default"](n,{left:e,operator:t.value,right:R()})}function U(){return R()}if(e in A)return A[e].clone();var L,j=0,V=U();return e in M?(M[e]++,M[e]>=k&&(A[e]=V)):M[e]=1,V}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i;var a=n(7),s=r(a),o=n(8),l=r(o),u=/^(true|false)/i,c=/^"([^\\]|\\.)*"/i,h=/^(\$?)(\w+)(\$?)(\d+)/i,p=/^((([1-9][0-9]*\.|0\.)[0-9]+)|([1-9][0-9]*)|0)/,d=/^(\/|\*|\^)/,f=/^(\+|\-|&)/,g=/^(<>|=|>=|<=|<|>)/,v=/^(\w+)\(/,m=/^(\w+)!/,b=/^\)/,w=/^\(/,y=/^,/,_=/^:/,x=/^%/,C=/^\s+/,k=10,M={},A={}},function(e,t){"use strict";function n(e,t){this.type=e,this.value=t}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=(0,u.getCellPos)(e.start.value),r=(0,u.getCellPos)(e.end.value),i=Math.min(n.row,r.row),a=Math.max(n.row,r.row),s=Math.min(n.col,r.col),o=Math.max(n.col,r.col),l=i;a>=l;l++)for(var c=s;o>=c;c++)t(l,c)}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),l=r(o),u=n(10),c=function(){function e(t,n){i(this,e),this.type=t;for(var r in n)this[r]=n[r]}return s(e,[{key:"walk",value:function(e){if(e(this)!==!1)switch(this.type){case"range":return this.start.walk(e),void this.end.walk(e);case"function":return void this.args.forEach(function(t){return t.walk(e)});case"sheetlookup":return void this.content.walk(e);case"binop_mult":case"binop_div":case"binop_add":case"binop_sub":case"binop_concat":case"binop_expon":this.left.walk(e),this.right.walk(e)}}},{key:"toString",value:function(){switch(this.type){case"boolean":return this.value?"true":"false";case"string":return JSON.stringify(this.value);case"number":return this.raw.toString();case"identifier":return this.raw.toUpperCase();case"sheetlookup":return this.sheet+"!"+this.content;case"range":return this.start+":"+this.end;case"function":return this.name+"("+this.args.map(function(e){return e.toString()}).join(",")+")";case"binop_mult":return this.left+"*"+this.right;case"binop_div":return this.left+"/"+this.right;case"binop_add":return this.left+"+"+this.right;case"binop_sub":return this.left+"-"+this.right;case"binop_concat":return this.left+"&"+this.right;case"binop_expon":return this.left+"^"+this.right}}},{key:"clone",value:function(){switch(this.type){case"boolean":case"string":return new e(this.type,{value:this.value});case"number":return new e(this.type,{value:this.value,raw:this.raw});case"identifier":return new e(this.type,{value:this.value,pinRow:this.pinRow,pinCol:this.pinCol,raw:this.raw});case"sheetlookup":return new e(this.type,{sheet:this.sheet,content:this.content.clone()});case"range":return new e(this.type,{start:this.start.clone(),end:this.end.clone()});case"function":return new e(this.type,{name:this.name,args:this.args.map(function(e){return e.clone()})});case"binop_mult":case"binop_div":case"binop_add":case"binop_sub":case"binop_concat":case"binop_expon":return new e(this.type,{left:this.left.clone(),right:this.right.clone()})}}},{key:"adjust",value:function(e,t){this.walk(function(n){if("identifier"===n.type){var r=(0,u.getCellPos)(n.value),i=r.row+(n.pinRow?0:e),a=r.col+(n.pinCol?0:t);n.value=(0,u.getCellID)(i,a);var s=TOKEN_CELL_ID.exec(n.value);n.raw=(n.pinCol?"$":"")+s[2]+(n.pinRow?"$":"")+s[4]}})}},{key:"findCellDependencies",value:function(e){this.walk(function(t){if("identifier"===t.type)e(t.value);else if("range"===t.type)a(t,function(t,n){return e((0,u.getCellID)(t,n))});else if("sheetlookup"===t.type)return!1})}},{key:"findSheetDependencies",value:function(e){this.walk(function(t){return"sheetlookup"===t.type?(t.content.findCellDependencies(function(n){return e(t.sheet,n)}),!1):void 0})}},{key:"run",value:function(e){switch(this.type){case"boolean":case"number":case"string":return this.value;case"identifier":return e.getCalculatedValueAtID(this.value);case"sheetlookup":return this.content.run(e.getSheet(this.sheet));case"binop_mult":return this.left.run(e)*this.right.run(e);case"binop_div":return this.left.run(e)/this.right.run(e);case"binop_add":return parseFloat(this.left.run(e))+parseFloat(this.right.run(e));case"binop_sub":return this.left.run(e)-this.right.run(e);case"binop_concat":return this.left.run(e).toString()+this.right.run(e).toString();case"binop_expon":return Math.pow(this.left.run(e),this.right.run(e));case"binop_comp_lt":return parseFloat(this.left.run(e))<parseFloat(this.right.run(e));case"binop_comp_lte":return parseFloat(this.left.run(e))<=parseFloat(this.right.run(e));case"binop_comp_gt":return parseFloat(this.left.run(e))>parseFloat(this.right.run(e));case"binop_comp_gte":return parseFloat(this.left.run(e))>=parseFloat(this.right.run(e));case"binop_comp_eq":return this.left.run(e)==this.right.run(e);case"binop_comp_neq":return this.left.run(e)!=this.right.run(e);case"range":var t=[];return a(this,function(n,r){t.push((0,o.parseNumMaybe)(e.getCalculatedValueAtPos(n,r)))}),t}if("function"!==this.type)throw new TypeError("Unknown exression node");return(0,l["default"])(this.name,this.args,e)}},{key:"compile",value:function(e){function t(e){var t=e.compile();return"num"===e.compiledReturnType()?t:"parseFloat("+t+")"}switch(this.type){case"boolean":case"number":case"string":return this.toString();case"identifier":return"sheet.getCalculatedValueAtID("+JSON.stringify(this.value)+")";case"sheetlookup":return"(function(sheet){"+this.content.compile()+"}(sheet.getSheet("+JSON.stringify(this.sheet)+")))";case"binop_mult":return"("+this.left.compile()+"*"+this.right.compile()+")";case"binop_div":return"("+this.left.compile()+"/"+this.right.compile()+")";case"binop_add":return"("+t(this.left)+"+"+t(this.right)+")";case"binop_sub":return"("+this.left.compile()+"-"+this.right.compile()+")";case"binop_concat":return"(("+this.left.compile()+").toString()+("+this.right.compile()+").toString())";case"binop_expon":return"Math.pow("+this.left.compile()+", "+this.right.compile()+")";case"binop_comp_lt":return"("+t(this.left)+" < "+t(this.right)+")";case"binop_comp_lte":return"("+t(this.left)+" <= "+t(this.right)+")";case"binop_comp_gt":return"("+t(this.left)+" > "+t(this.right)+")";case"binop_comp_gte":return"("+t(this.left)+" >= "+t(this.right)+")";case"binop_comp_eq":return"("+this.left.compile()+" == "+this.right.compile()+")";case"binop_comp_neq":return"("+this.left.compile()+" != "+this.right.compile()+")";case"range":var n=[];return a(this,function(e,t){n.push("parseNumMaybe(sheet.getCalculatedValueAtPos("+e+", "+t+"))")}),n.join(",");case"function":return"execFunc("+JSON.stringify(this.name)+",["+this.args.map(function(e){return e.compile()}).join(",")+"], sheet)";default:throw new TypeError("Cannot compile unknown expression nodes")}}},{key:"compiledReturnType",value:function(){switch(this.type){case"boolean":return"bool";case"number":return"num";case"string":return"str";case"identifier":return"mixed";case"sheetlookup":return"mixed";case"binop_mult":return"num";case"binop_div":return"num";case"binop_add":return"num";case"binop_sub":return"num";case"binop_concat":return"str";case"binop_expon":return"num";case"binop_comp_lt":return"bool";case"binop_comp_lte":return"bool";case"binop_comp_gt":return"bool";case"binop_comp_gte":return"bool";case"binop_comp_eq":return"bool";case"binop_comp_neq":return"bool";case"range":return"arr";case"function":return"mixed"}return"mixed"}}]),e}();t["default"]=c},function(e,t){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t,n){p[n||t]=e[t].bind(e)}function i(e,t,r){for(var i,u,d,f,g=[],v=0;v<t.length;v++){var m=t[v].run(r);m&&"object"===("undefined"==typeof m?"undefined":h(m))?g=g.concat(m):g.push(m)}if(e=e.toLowerCase(),e in p)return p[e].apply(p,n(g));var b,w;switch(e){case"and":return g.every(c);case"average":return b=g.filter(l),b.length?b.reduce(s)/b.length:0;case"averagea":return g.map(c).reduce(s)/g.length;case"code":case"asc":return g[0].toString().charCodeAt(0)||0;case"chr":case"combin":return a(g[0])/a(g[0]-g[1]);case"concatenate":return g.reduce(function(e,t){return e.toString()+t.toString()});case"count":return g.filter(l).length;case"counta":return g.filter(function(e){return""!==e&&null!==e&&void 0!==e}).length;case"countblank":return g.filter(function(e){return""===e}).length;case"countif":return g.filter(function(e){return e==g[1]}).length;case"degrees":return 57.2957795*g[0];case"dollar":return"$"+o(0|g[0])+(g[1]?"."+parseFloat(g[0]).toFixed(g[1]).split(".")[1]:"");case"even":return 2*Math.ceil(g[0]/2);case"exact":return g[0].toString()===g[1].toString();case"fact":return a(g[0]);case"factdouble":return a(g[0],2);case"search":case"find":return g[1].toString().substr((g[2]||1)-1).indexOf(g[0].toString());case"fixed":return(g[2]?function(e){return e}:o)(g[0])+(g[1]?"."+parseFloat(g[0]).toFixed(g[1]).split(".")[1]:"");case"frequency":return g.slice(0,-1).filter(function(e){return e<=g[g.length-1]}).length;case"if":return g[0]?g[1]:g[2];case"isblank":return""===g[0]||null===g[0];case"iseven":return g[0]%2===0;case"isnottext":return"string"!=typeof g[0];case"isnumber":return"number"==typeof g[0];case"isodd":return g[0]%2!==0;case"istext":return"string"==typeof g[0];case"large":return g.slice(0,-1).sort().reverse()[g[g.length-1]];case"lower":case"lcase":return g[0].toString().toLowerCase();case"left":return g[0].toString().substr(0,g[1]||1);case"len":return g[0].toString().length;case"max":return(i=Math).max.apply(i,n(g.filter(l)));case"maxa":return(u=Math).max.apply(u,n(g.map(c)));case"median":return b=g.map(parseFloat).sort(),b.length%2===0?(b[(b.length-1)/2|0]+b[Math.ceil((b.length-1)/2)])/2:b[(b.length-1)/2];case"mid":return g[0].toString().substr((g[1]||1)-1,g[2]);case"min":return(d=Math).min.apply(d,n(g.filter(l)));case"mina":return(f=Math).min.apply(f,n(g.map(c)));case"mod":return g[0]%g[1];case"not":return!g[0];case"or":return g.reduce(function(e,t){return e||t});case"pi":return Math.PI;case"product":return g.reduce(function(e,t){return e*t});case"proper":return g[0].toString().split(/\s/).map(function(e){return e[0].toUpperCase()+e.substr(1)});case"quotient":return g[0]/g[1]|0;case"radians":return g[0]/57.2957795;case"randbetween":return Math.random()*(g[1]-g[0])+g[0];case"replace":return g[0].toString().substr(0,g[1]-1)+g[3].toString()+g[0].toString().substr(g[1]-1+g[2]);case"rept":return new Array(g[1]+1).join(g[0].toString());case"right":return g[0].toString().substr(-1*g[1]||-1);case"round":return Math.round(g[0]||0).toFixed(g[1]||0);case"fix":case"rounddown":return g[0]<0?Math.ceil(g[0]):Math.floor(g[0]);case"roundup":return g[0]>0?Math.ceil(g[0]):Math.floor(g[0]);case"sign":return g[0]/Math.abs(g[0])||0;case"space":return new Array(g[0]+1).join(" ");case"sqrtpi":return Math.sqrt(g[0]*Math.PI);case"stdev":return b=g.filter(l).map(c),w=b.reduce(s)/b.length,Math.sqrt(b.map(function(e){return Math.pow(e-w,2)}).reduce(s)/(b.length-1));case"stdeva":return b=g.map(c),w=b.reduce(s)/b.length,Math.sqrt(b.map(function(e){return Math.pow(e-w,2)}).reduce(s)/(b.length-1));case"stdevp":return b=g.filter(l).map(c),w=b.reduce(s)/b.length,Math.sqrt(b.map(function(e){return Math.pow(e-w,2)}).reduce(s)/b.length);case"stdevpa":return b=g.map(c),w=b.reduce(s)/b.length,Math.sqrt(b.map(function(e){return Math.pow(e-w,2)}).reduce(s)/b.length);case"t":case"str":return g[0].toString();case"sum":return g.map(c).reduce(s);case"upper":case"ucase":return g[0].toString().toUpperCase();case"value":case"val":return(/^\d+/.exec(g[0].toString().replace(/\s/g,""))||[""])[0];case"var":return b=g.filter(l).map(c),w=b.reduce(s)/b.length,b.map(function(e){return Math.pow(e-w,2)}).reduce(s)/(b.length-1);case"vara":return b=g.map(c),w=b.reduce(s)/b.length,b.map(function(e){return Math.pow(e-w,2)}).reduce(s)/(b.length-1);case"varp":return b=g.filter(l).map(c),w=b.reduce(s)/b.length,b.map(function(e){return Math.pow(e-w,2)}).reduce(s)/b.length;case"varpa":return b=g.map(c),w=b.reduce(s)/b.length,b.map(function(e){return Math.pow(e-w,2)}).reduce(s)/b.length}}function a(e){var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1];if(!t&&e>2&&d[e])return d[e];var n=2>e?e:e*a(e-t);return t||(d[e]=n),n}function s(e,t){return e+t}function o(e){return e.toString().split(/(?=(?:\d\d\d)*$)/).join(",")}function l(e){return!isNaN(parseFloat(e))}function u(e){var t=parseFloat(e);return isNaN(t)?e:t}function c(e){var t=parseFloat(e);return isNaN(t)?e?1:0:t}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=i,t.parseNumMaybe=u;var p={};r(Math,"abs"),r(Math,"acos"),r(Math,"acosh"),r(Math,"asin"),r(Math,"asinh"),r(Math,"atan"),r(Math,"atan2"),r(Math,"atanh"),r(Math,"ceil"),r(Math,"ceil","ceiling"),r(Math,"cos"),r(Math,"cosh"),r(Math,"exp"),r(Math,"floor","int"),r(Math,"floor"),r(Math,"log","ln"),r(Math,"log10","log10"),r(Math,"pow","power"),r(Math,"pow"),r(Math,"random","rand"),r(Math,"random"),r(Math,"sin"),r(Math,"sinh"),r(Math,"sqrt"),r(Math,"tan"),r(Math,"tanh"),r(String,"fromCharCode","char");var d=[]},function(e,t){"use strict";function n(e,t){var n="";e+=1;do{var r=t%26;t-=r,t/=26,n=String.fromCharCode(r+65)+n}while(t);return n+e}function r(e){if(e in a)return a[e];for(var t=/^([a-z]+)([0-9]+)$/i.exec(e),n=t[1],r=0;n;){var s=n.charCodeAt(0)-65;r*=26,r+=s,n=n.substr(1)}var o=new i(r,t[2]-1);return a[e]=o,o}function i(e,t){this.col=e,this.row=t}Object.defineProperty(t,"__esModule",{value:!0}),t.getCellID=n,t.getCellPos=r;var a={}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var s=n(12),o=n(13),l=r(o),u=n(10),c=n(14),h=n(15),p=n(6),d=r(p),f=n(9),g=100,v=1,m={width:6,height:6},b=Symbol("window.onmouseup"),w=function(){function e(t){var n=this,r=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];i(this,e),this.elem=t,this.elem.className="websheet",Object.assign(r,m),this.height=r.height,this.width=r.width,this.columnWidths=[];for(var a=0;a<r.width;a++)this.columnWidths[a]=g;this.data=[],this.calculated=[],this.formatting=[],this.depUpdateQueue=null,this.dependencies={},this.dependants={},this.cellCache={},this.dragType=s.DRAG_NONE,this.dragSource=null,(0,h.listen)(window,"mouseup",this[b]=function(e){n.dragType!==s.DRAG_NONE&&(n.dragType=s.DRAG_NONE,n.dragSource=null,n.elem.className="websheet")}),this.valueUpdates=new l["default"],this.calculatedUpdates=new l["default"],this.context=r.context||null,this.name=null}return a(e,[{key:"addColumn",value:function(){this.width+=1,this.columnWidths.push(g),this.forceRerender()}},{key:"addRow",value:function(){this.height+=1,this.data.push(new Array(this.width)),this.calculated.push(new Array(this.width)),this.formatting.push(new Array(this.width)),this.forceRerender()}},{key:"calculateValueAtPosition",value:function(e,t,n){var r=this;if(n){var i,a=(0,u.getCellID)(e,t),s=(0,d["default"])(n);try{i=s.run(this),isNaN(i)&&(i="#VALUE!")}catch(o){throw o}this.calculated[e]=this.calculated[e]||[];var l=this.calculated[e][t]!==i;l&&(this.calculated[e][t]=i);var c=[];s&&(s.findCellDependencies(function(e){if(-1===c.indexOf(e)){c.push(e);var t;e in r.dependencies?(t=r.dependencies[e])&&-1===t.indexOf(a)&&t.push(a):r.dependencies[e]=[a]}}),this.context&&!function(){r.context.clearDependencies(r,a);var i=[];s.findSheetDependencies(function(s,o){if(r.context.sheets[s.toUpperCase()]){var l=s+"!"+o;-1===i.indexOf(l)&&(i.push(l),r.context.setDependency(r,a,s,o,function(){r.calculateValueAtPosition(e,t,n)}))}})}()),this.dependants[a]=c,this.getCell(a).value=i,l&&(this.updateDependencies(a),this.calculatedUpdates.fire(a,i))}}},{key:"clearCell",value:function(e,t){var n=(0,u.getCellID)(e,t),r=this.getCell(n);r&&(r.value="",e in this.data&&delete this.data[e][t],e in this.calculated&&delete this.calculated[e][t],this.clearDependants(n),this.dependants[n]=[])}},{key:"clearDependants",value:function(e){var t=this.dependants[e];if(t){for(var n=0;n<t.length;n++){var r=this.dependencies[t[n]];if(r){var i=r.indexOf(e);-1!==i&&r.splice(i,1)}}this.context&&this.context.clearDependencies(this,e)}}},{key:"forceRerender",value:function(){var e=this,t=this.columnWidths.reduce(function(e,t){return e+t});for(t+=v,this.elem.style.width=t+"px";this.elem.childNodes.length;)this.elem.removeChild(this.elem.firstChild);this.cellCache={};for(var n=[],r=0;r<this.height;r++){var i=document.createElement("div");i.style.width=t+"px",i.className="websheet-row",1>r&&(i.className+=" websheet-row-sticky"),this.elem.appendChild(i);for(var a=this.data[r]||[],s=this.calculated[r]||[],o=this.formatting[r]||[],l=function(){var t=document.createElement("input");t.className="websheet-cell";var l=document.createElement("div");l.className="websheet-cell-wrapper",l.style.width=e.columnWidths[h]-1+"px",l.appendChild(t),i.appendChild(l),t.value=s[h]||a[h]||"",t.setAttribute("data-id",t.title=(0,u.getCellID)(r,h)),t.setAttribute("data-id-prev-col",(0,u.getCellID)(r,h-1)),t.setAttribute("data-id-prev-row",(0,u.getCellID)(r-1,h)),t.setAttribute("data-id-next-col",(0,u.getCellID)(r,h+1)),t.setAttribute("data-id-next-row",(0,u.getCellID)(r+1,h)),t.setAttribute("data-row",r),t.setAttribute("data-col",h),"="===t.value[0]&&n.push(function(){return e.setValueAtPosition(r,h,t.value,!0)});var c=o[h];if(!c)return"continue";for(var p in c)c.hasOwnProperty(p)&&(t.style[p]=c[p])},h=0;h<this.width;h++){l()}}(0,c.initEvents)(this),n.forEach(function(e){return e()})}},{key:"getCalculatedValueAtID",value:function(e){var t=(0,u.getCellPos)(e);return this.getCalculatedValueAtPos(t.row,t.col)}},{key:"getCalculatedValueAtPos",value:function(e,t){return(0,f.parseNumMaybe)((this.calculated[e]||[])[t]||(this.data[e]||[])[t]||0)}},{key:"getCell",value:function(e){return e in this.cellCache?this.cellCache[e]:this.cellCache[e]=this.elem.querySelector('[data-id="'+e+'"]')}},{key:"getSheet",value:function(e){if(!this.context)throw new Error("No context to extract sheet from");if(e=e.toUpperCase(),!(e in this.context.sheets))throw new Error("Undefined sheet requested");return this.context.sheets[e]}},{key:"getValueAtPos",value:function(e,t){return(this.data[e]||[])[t]||null}},{key:"insertColumnBefore",value:function(e){this.width+=1,this.columnWidths.splice(e,0,g);for(var t=0;t<this.height;t++)this.data[t]&&this.data[t].splice(e,0,null),this.calculated[t]&&this.calculated[t].splice(e,0,null),this.formatting[t]&&this.formatting[t].splice(e,0,null);this.forceRerender()}},{key:"insertRowBefore",value:function(e){this.height+=1,this.data.splice(e,0,new Array(this.width)),this.calculated.splice(e,0,new Array(this.width)),this.formatting.splice(e,0,new Array(this.width)),this.forceRerender()}},{key:"loadData",value:function(e){for(;this.height<e.length;)this.addRow();for(;this.width<e[0].length;)this.addColumn();for(var t=0;t<e.length;t++){this.data[t]=this.data[t]||[];for(var n=0;n<e[t].length;n++)this.data[t][n]=e[t][n]}this.forceRerender()}},{key:"popColumn",value:function(){if(this.width<2)throw new Error("Cannot make spreadsheet that small");this.width-=1,this.columnWidths.pop();for(var e=0;e<this.height;e++)this.data[e]&&this.data[e].length>this.width&&this.data[e].pop(),this.calculated[e]&&this.calculated[e].length>this.width&&this.calculated[e].pop(),this.formatting[e]&&this.formatting[e].length>this.width&&this.formatting[e].pop();this.forceRerender()}},{key:"popRow",value:function(){if(this.height<2)throw new Error("Cannot make spreadsheet that small");this.height-=1,this.data.pop(),this.calculated.pop(),this.formatting.pop(),this.forceRerender()}},{key:"removeColumn",value:function(e){if(this.width<2)throw new Error("Cannot make spreadsheet that small");if(0>e||e>=this.width)throw new Error("Removing cells that do not exist");this.width-=1,this.columnWidths.splice(e,1);for(var t=0;t<this.height;t++)this.data[t]&&this.data[t].splice(e,1),this.calculated[t]&&this.calculated[t].splice(e,1),this.formatting[t]&&this.formatting[t].splice(e,1);this.forceRerender()}},{key:"removeRow",value:function(e){if(this.height<2)throw new Error("Cannot make spreadsheet that small");if(0>e||e>=this.width)throw new Error("Removing cells that do not exist");this.height-=1,this.data.splice(e,1),this.calculated.splice(e,1),this.formatting.splice(e,1),this.forceRerender()}},{key:"setValueAtPosition",value:function(e,t,n){var r=arguments.length<=3||void 0===arguments[3]?!1:arguments[3],i=(0,u.getCellID)(e,t),a=this.getCell(i);this.data[e]=this.data[e]||[],(this.data[e][t]!==n||r)&&(this.data[e][t]=n,this.calculated[e]&&delete this.calculated[e][t],this.clearDependants(i),this.valueUpdates.fire(i,n),"="===n[0]?this.calculateValueAtPosition(e,t,n.substr(1)):(this.updateDependencies(i),a&&(a.value=n)))}},{key:"updateDependencies",value:function(e){var t=this.dependencies[e];if(t)if(this.depUpdateQueue)for(var n=0;n<t.length;n++)-1===this.depUpdateQueue.indexOf(t[n])&&this.depUpdateQueue.push(t[n]);else{this.depUpdateQueue=t.concat([]);for(var n=0;n<t.length;n++)this.depUpdateQueue.push(t[n]);for(;this.depUpdateQueue.length;){var r=(0,u.getCellPos)(this.depUpdateQueue.shift()),i=r.row,a=r.col;this.calculateValueAtPosition(i,a,this.data[i][a].substr(1))}this.depUpdateQueue=null}}}]),e}();t["default"]=w},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DRAG_HANDLE=2,t.DRAG_MOVE=1,t.DRAG_NONE=0},function(e,t){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){r(this,e),this.listeners={},this.allListeners=[]}return i(e,[{key:"fire",value:function(e){var t;for(t=0;t<this.allListeners.length;t++){var r;(r=this.allListeners)[t].apply(r,arguments)}if(e in this.listeners){var i=Array.prototype.slice.call(arguments,1);for(t=0;t<this.listeners[e].length;t++){var a;(a=this.listeners[e])[t].apply(a,n(i))}}}},{key:"on",value:function(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}},{key:"onAll",value:function(e){this.allListeners.push(e)}},{key:"off",value:function(e,t){if(e in listeners){var n=listeners[e].indexOf(t);-1!==n&&listeners[e].splice(n,1)}}},{key:"offAll",value:function(e){var t=this.allListeners.indexOf(e);-1!==t&&this.allListeners[name].splice(t,1);
}}]),e}();t["default"]=a},function(e,t,n){"use strict";function r(e){(0,d.unlisten)(e.elem,"focus"),(0,d.unlisten)(e.elem,"blur"),(0,d.unlisten)(e.elem,"keyup"),(0,d.unlisten)(e.elem,"keydown"),(0,d.unlisten)(e.elem,"mousedown"),(0,d.unlisten)(e.elem,"mouseup"),(0,d.unlisten)(e.elem,"mouseover")}function i(e){r(e);var t=e.elem;(0,d.listen)(t,"focus",a.bind(e)),(0,d.listen)(t,"blur",s.bind(e)),(0,d.listen)(t,"keyup",l.bind(e)),(0,d.listen)(t,"keydown",o.bind(e)),(0,d.listen)(t,"mousedown",u.bind(e)),(0,d.listen)(t,"mouseup",c.bind(e)),(0,d.listen)(t,"mouseover",h.bind(e))}function a(e){var t=0|e.target.getAttribute("data-row"),n=0|e.target.getAttribute("data-col");e.target.value=(this.data[t]||[])[n]||"",e.target.select(0,e.target.value.length),e.target.parentNode.className="websheet-cell-wrapper websheet-has-focus"}function s(e){var t=0|e.target.getAttribute("data-row"),n=0|e.target.getAttribute("data-col");this.setValueAtPosition(t,n,e.target.value),this.calculated[t]&&n in this.calculated[t]&&(e.target.value=this.calculated[t][n]),e.target.parentNode.className="websheet-cell-wrapper"}function o(e){var t;37===e.keyCode&&0===e.target.selectionStart?t=this.getCell(e.target.getAttribute("data-id-prev-col")):39===e.keyCode&&e.target.selectionEnd===e.target.value.length&&(t=this.getCell(e.target.getAttribute("data-id-next-col"))),t&&(t.focus(),e.preventDefault())}function l(e){var t;13===e.keyCode||40===e.keyCode?t=this.getCell(e.target.getAttribute("data-id-next-row")):38===e.keyCode&&(t=this.getCell(e.target.getAttribute("data-id-prev-row"))),t&&t.focus()}function u(e){var t=e.target;if(t.classList.contains("websheet-has-focus")){e.preventDefault();var n=this.dragSource=t.firstChild.getAttribute("data-id"),r=(0,p.getCellPos)(n);if(this.setValueAtPosition(r.row,r.col,t.firstChild.value),e.layerX>t.clientWidth-10&&e.layerY>t.clientHeight-10)return void(this.dragType=f.DRAG_HANDLE);this.dragType=f.DRAG_MOVE,this.elem.className+=" websheet-grabbing"}}function c(e){var t=e.target;if(this.dragType!==f.DRAG_NONE&&t.classList.contains("websheet-cell")){var n=(0,p.getCellPos)(this.dragSource),r=(0,p.getCellPos)(t.getAttribute("data-id"));if(this.dragType===f.DRAG_MOVE)this.setValueAtPosition(r.row,r.col,this.getValueAtPos(n.row,n.col)||""),this.clearCell(n.row,n.col),e.target.focus();else if(this.dragType===f.DRAG_HANDLE&&(n.row===r.row||n.col===r.col)){var i=this.getValueAtPos(n.row,n.col)||"",a="="===i[0]&&parse(i.substr(1));if(n.row===r.row){for(var s=Math.min(n.col,r.col),o=s;o<=Math.max(n.col,r.col);o++)if(o!==n.col)if(a){var l=a.clone();l.adjust(0,o-s),this.setValueAtPosition(n.row,o,"="+l.toString())}else this.setValueAtPosition(n.row,o,i)}else if(n.col===r.col){for(var s=Math.min(n.row,r.row),o=s;o<=Math.max(n.row,r.row);o++)if(o!==n.row)if(a){var l=a.clone();l.adjust(o-s,0),this.setValueAtPosition(o,n.col,"="+l.toString())}else this.setValueAtPosition(o,n.col,i)}else console.error("Cannot drag handle diagonally")}}this.elem.className="websheet",this.dragType=f.DRAG_NONE,this.dragSource=null;for(var u=this.elem.querySelectorAll(".websheet-cell-hover"),o=0;o<u.length;o++)u[o].classList.remove("websheet-cell-hover")}function h(e){var t=this;if(this.dragType!==f.DRAG_NONE&&e.target.classList.contains("websheet-cell")){for(var n=[],r=this.elem.querySelectorAll(".websheet-cell-hover"),i=0;i<r.length;i++)n.push(r[i].firstChild.dataset.id);var a=e.target.dataset.id;if(a!==this.dragSource){if(this.dragType===f.DRAG_HANDLE){var s=(0,p.getCellPos)(a),o=(0,p.getCellPos)(this.dragSource);if(s.col===o.col)for(var l=Math.min(o.row,s.row);l<=Math.max(o.row,s.row);l++){var u=(0,p.getCellID)(l,o.col),c=n.indexOf(u);-1!==c?n.splice(c,1):this.getCell(u).parentNode.classList.add("websheet-cell-hover")}else if(s.row===o.row)for(var h=Math.min(o.col,s.col);h<=Math.max(o.col,s.col);h++){var u=(0,p.getCellID)(o.row,h),c=n.indexOf(u);-1!==c?n.splice(c,1):this.getCell(u).parentNode.classList.add("websheet-cell-hover")}}else e.target.parentNode.classList.add("websheet-cell-hover");n.forEach(function(e){t.getCell(e).parentNode.classList.remove("websheet-cell-hover")})}}}Object.defineProperty(t,"__esModule",{value:!0}),t.unbindEvents=r,t.initEvents=i,t.onFocus=a,t.onBlur=s,t.onKeydown=o,t.onKeyup=l,t.onMousedown=u,t.onMouseup=c,t.onMouseover=h;var p=n(10),d=n(15),f=n(12)},function(e,t){"use strict";function n(e,t,n){i in e||(e[i]={}),e[i][t]=e[i][t]||[],e[i][t].push(n),e.addEventListener(t,n,e!==window)}function r(e,t){e[i]&&e[i][t]&&e[i][t].forEach(function(n){e.removeEventListener(t,n,e!==window)})}Object.defineProperty(t,"__esModule",{value:!0}),t.listen=n,t.unlisten=r;var i=Symbol("websheets listeners")},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var s=n(13),o=r(s),l=function(){function e(){i(this,e),this.sheets={},this.dependencies={},this.events=new o["default"]}return a(e,[{key:"register",value:function(e,t){var n=this;this.sheets[t.toUpperCase()]=e,e.name=t,e.valueUpdates.onAll(function(e,r){n.events.fire("value",t,e,r)}),e.calculatedUpdates.onAll(function(e,r){n.events.fire("calculated",t,e,r)})}},{key:"getSheet",value:function(e){return e=e.toUpperCase(),this.sheets.hasOwnProperty(e)?this.sheets[e]:null}},{key:"lookup",value:function(e,t){return e=e.toUpperCase(),this.sheets.hasOwnProperty(e)?this.sheets[e].getCalculatedValueAtID(t):null}},{key:"setDependency",value:function(e,t,n,r,i){if(n=n.toUpperCase(),this.sheets.hasOwnProperty(sheetName)){var a=e.name.toUpperCase()+"!"+t;this.dependencies[a]=this.dependencies[a]||[];var s=function(e,t){("value"!==t||"="!==e[0])&&i(e)};this.dependencies[a].push([n,r,s]),this.sheets[n].valueUpdates.on(r,s),this.sheets[n].calculatedUpdates.on(r,s)}}},{key:"clearDependencies",value:function(e,t){var n=this,r=e.name.toUpperCase()+"!"+t;this.dependencies.hasOwnProperty(r)&&(this.dependencies[r].forEach(function(e){n.sheets[e[0]].valueUpdates.off(e[1],e[2]),n.sheets[e[0]].calculatedUpdates.off(e[1],e[2])}),this.dependencies[r]=[])}}]),e}();t["default"]=l}]);